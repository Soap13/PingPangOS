/*  *c语言和汇编的联合测试 * *王征 2014-02-03 */#include "io.h"#include "interrupt.h"//==========================================/* *第一次进入的时候的提示信息 */void show_title(){     put_str("Welcom to the os world!\r\n");}/* *普通的中断异常处理 *没有中断说明的则默认的错误码是0xFFFFFFFF *这样就通用了，参考于渊的第五章 */void normal_interrupt_process(unsigned int idt_sel, unsigned int error_code, unsigned int code_addr,unsigned int code_sel,unsigned int flages){        char err_description[][64] = {		                "#DE Divide Error",					"#DB RESERVED",					"—  NMI Interrupt",					"#BP Breakpoint",					"#OF Overflow",					"#BR BOUND Range Exceeded",					"#UD Invalid Opcode (Undefined Opcode)",					"#NM Device Not Available (No Math Coprocessor)",					"#DF Double Fault",					"    Coprocessor Segment Overrun (reserved)",					"#TS Invalid TSS",					"#NP Segment Not Present",					"#SS Stack-Segment Fault",					"#GP General Protection",					"#PF Page Fault",					"—  (Intel reserved. Do not use.)",					"#MF x87 FPU Floating-Point Error (Math Fault)",					"#AC Alignment Check",					"#MC Machine Check",					"#XF SIMD Floating-Point Exception",					"#Normal Exception"				};	put_str("\r\nError message:");    put_strln(err_description[idt_sel]);    put_str("Error Code:");    put_hexln(error_code);	    put_str("EIP:");					put_hexln(code_addr);	put_str(" CS:");    put_hexln(code_sel);	put_str("FLG:");    put_hexln(flages);	      exit();}/* *键盘中断的安装 */void init_key_interrupt(){    put_str("Key interrupt init is start!\r\n");	make_idt_description((unsigned int)key_interrupt,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)0x21);} /* *实例化时钟中断的处理 */void init_clock_interrupt(){   put_str("Clock interrupt init is start!\r\n");   make_idt_description((unsigned int)clock_interrupt,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)0x20);} /** *安装实例化0x80号服务 *用户态的级别 */ void init_sys_call(){     put_str("Sys call interrupt init is start!\r\n");	 make_idt_description((unsigned int)clock_interrupt,(unsigned int)0x0028,(unsigned int)0xEE00,(unsigned int)0x20); }/* *实例化其它的中断处理 */void init_other_interrupt(){   put_str("0-19 Interrupt init is start!\r\n");   make_idt_description((unsigned int)interrupt_number_00,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)0);   make_idt_description((unsigned int)interrupt_number_01,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)1);   make_idt_description((unsigned int)interrupt_number_02,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)2);   make_idt_description((unsigned int)interrupt_number_03,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)3);   make_idt_description((unsigned int)interrupt_number_04,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)4);   make_idt_description((unsigned int)interrupt_number_05,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)5);   make_idt_description((unsigned int)interrupt_number_06,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)6);   make_idt_description((unsigned int)interrupt_number_07,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)7);   make_idt_description((unsigned int)interrupt_number_08,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)8);   make_idt_description((unsigned int)interrupt_number_09,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)9);   make_idt_description((unsigned int)interrupt_number_10,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)10);   make_idt_description((unsigned int)interrupt_number_11,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)11);   make_idt_description((unsigned int)interrupt_number_12,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)12);   make_idt_description((unsigned int)interrupt_number_13,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)13);   make_idt_description((unsigned int)interrupt_number_14,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)14);   make_idt_description((unsigned int)interrupt_number_15,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)15);   make_idt_description((unsigned int)interrupt_number_16,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)16);   make_idt_description((unsigned int)interrupt_number_17,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)17);   make_idt_description((unsigned int)interrupt_number_18,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)18);   make_idt_description((unsigned int)interrupt_number_19,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)19);  }/* *实例化8259A芯片的，并且安装idt */void init_idt(){     put_str("Init the normal interrupt and exception starting!\r\n");	 //1.实例化芯片 	 Init8259A();	 //2.全部安装通用中断     int count=0;	 for(;count<250;count++){	  make_idt_description((unsigned int)normal_interrupt,(unsigned int)0x0028,(unsigned int)0x8E00,(unsigned int)count);	 }	 //3.#0x21键盘的安装 	 init_key_interrupt(); 	 //4.#0x20时钟中断的处理这里保留	 init_clock_interrupt();	 //5.其他的中断处理总的20个	 init_other_interrupt();	 //6.#0x80系统调用	 init_sys_call();} 